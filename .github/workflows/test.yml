name: clj run tests
on: [push, pull_request]
jobs:
  Testing:
    runs-on: ubuntu-latest
    steps:

      # Setup Clojure & deps.edn
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: Install clojure tools
        uses: DeLaGuardo/setup-clojure@9.4
        with:
          cli: latest

      # Install pandoc binary
      - uses: actions/checkout@master
      - uses: nikeee/setup-pandoc@v1

      # Read env (for learning github actions)
      - run: env

      # Setup olorm config
      - run: mkdir -p "$HOME/.config/olorm/"
      - run: echo "{:repo-path \"$GITHUB_WORKSPACE\"}" > /home/runner/.config/olorm/config.edn

      # Setup git
      - run: git config --global user.name "Github actions"
      - run: git config --global user.email "github-actions@ci.mikrobloggeriet.no"

      # Download test deps
      - run: clojure -A:test -e :test-deps-downloaded
      # Run tests
      - run: clojure -M:run-tests
